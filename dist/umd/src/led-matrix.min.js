!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.ledMatrix=e():t.ledMatrix=e()}(this,function(){return function(t){var e={};function r(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},r.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";r.r(e);class i{static throwIfNull(t,e){if(null==t)throw`${e} property cannot be set to null`}static throwIfNegative(t,e){if(t<0)throw`${e} property cannot be set to a negative number (${t})`}static throwIfNotBetween(t,e,r,i){if(t<r||t>i)throw`Seek expects a value between ${r} and ${i}`}static getDescriptionForProperty(t,e){return`${t}'s ${e}`}}class n{constructor(t,e,r){if(this.CLASS_NAME=n.name,this._pattern=t,this._output=e,!(e.size>=r))throw`Output size (${e.size}) can't be smaller than the character's width (${r})`;if(this._width=r,e.size%r!=0)throw`Output size (${e.size}) must be divisible by the character's width (${r})`;this._height=e.size/r}get width(){return this._width}get height(){return this._height}get pattern(){return this._pattern}get output(){return this._output}getColumn(t){i.throwIfNotBetween(t,i.getDescriptionForProperty(this.CLASS_NAME,"getColumn"),0,this._width-1);let e=[];for(let r=0;r<this._height;r++)e.push(this._output.atIndex(r*this._width+t));return e}getRow(t){i.throwIfNotBetween(t,i.getDescriptionForProperty(this.CLASS_NAME,"getRow"),0,this._height-1);let e=[];for(let r=0;r<this._width;r++)e.push(this._output.atIndex(t*this._width+r));return e}hasPattern(t){return this._pattern==t}}class a{constructor(t){this._bitPerIndex=8,this._size=t.length,this._array=new Uint8Array(Math.ceil(this._size/this._bitPerIndex)),this._pointer=0,this.pushAll(t)}get size(){return this._size}push(t){if(this._pointer==this._size)throw`Bit array max size reached (${this._size})`;const e=this._createMask(this._pointer);this._matchesMask(e,this._array[this._arrayIndex(this._pointer)])?0===t&&(this._array[this._arrayIndex(this._pointer)]^=e):1===t&&(this._array[this._arrayIndex(this._pointer)]^=e),this._pointer++}pushAll(t){t.forEach(t=>{this.push(t)})}atIndex(t){if(t>this._size)throw`Index (${t}) exceeds the size of the bit array (${this._size})`;const e=this._createMask(t);return this._matchesMask(e,this._array[this._arrayIndex(t)])?1:0}atIndexRange(t,e){if(t+e-1>this._size)throw`Index (${t}) exceeds the size of the bit array (${this._size})`;const r=[];for(let i=0;i<e;i++){const e=this._createMask(t+i);r.push(this._matchesMask(e,this._array[this._arrayIndex(t+i)])?1:0)}return r}_matchesMask(t,e){return 0!=(t&e)}_createMask(t){return 1<<this._bitPerIndex-1-this._arrayIndexOffset(t)}_arrayIndex(t){return Math.floor(t/this._bitPerIndex)}_arrayIndexOffset(t){return t%this._bitPerIndex}}class s{static scale(t,e,r){const i=1/r,n=e*r,a=t.length/e*r;let s=new Array(n*a);for(let r=0;r<a;r++)for(let a=0;a<n;a++){const h=Math.floor(a*i),c=Math.floor(r*i);s[r*n+a]=t[c*e+h]}return s}}class h{constructor(){this.handlers=[]}on(t){this.handlers.push(t)}off(t){this.handlers=this.handlers.filter(e=>e!==t)}trigger(t){this.handlers.slice(0).forEach(e=>e(t))}expose(){return this}}class c{constructor(t){this.CLASS_NAME=c.name,this.onPropertyChange=new h,this._characters=[],this._letterSpacing=t.letterSpacing,this.padding=t.padding,this._size=t.size,this.onPropertyChange.trigger()}get PropertyChange(){return this.onPropertyChange.expose()}get letterSpacing(){return this._letterSpacing}get padding(){return this._padding}get characters(){return this._characters}get input(){return this._input}get size(){return this._size}get width(){const t=this._horizontalPaddingWidth()+this._totalSpacingWidth();return this._characters.length>0?t+this._characters.map(t=>t.width).reduce((t,e)=>t+e):t}get height(){return this._characters.length>0?this._verticalPaddingWidth()+this._characters.reduce((t,e)=>e.height>t.height?e:t).height:this._verticalPaddingWidth()}set letterSpacing(t){const e=i.getDescriptionForProperty(this.CLASS_NAME,"padding");i.throwIfNull(t,e),i.throwIfNegative(t,e);const r=this._letterSpacing;this._letterSpacing=t,this._emitPropertyChangeEvent(t,r)}set padding(t){const e=i.getDescriptionForProperty(this.CLASS_NAME,"padding");t.forEach(t=>{i.throwIfNull(t,e),i.throwIfNegative(t,e)});const r=1==t.length?[t[0],t[0],t[0],t[0]]:2==t.length?[t[0],t[1],t[0],t[1]]:t;if(this._padding){let t=[...this._padding];this._padding=[r[0],r[1],r[2],r[3]],this._padding[0]==t[0]&&this._padding[1]==t[1]&&this._padding[2]==t[2]&&this._padding[3]==t[3]||this.onPropertyChange.trigger()}else this._padding=[r[0],r[1],r[2],r[3]],this.onPropertyChange.trigger()}getColumnAtIndex(t){if((t%=this.width)<this._padding[3]||t>=this.width-this._padding[1])return this._createBitOffArrayOfLength(this.height);let e,r=this._padding[3];return this._characters.some(i=>{if((r+=i.width)>t){const n=i.getColumn(t-(r-i.width));return(e=this._createBitOffArrayOfLength(this._padding[0]).concat(n).concat(this._createBitOffArrayOfLength(this._padding[2]))).length<this.height&&(e=e.concat(this._createBitOffArrayOfLength(this.height-n.length))),!0}if((r+=this._letterSpacing)>t)return e=this._createBitOffArrayOfLength(this.height),!0}),e}getRowAtIndex(t){if((t%=this.height)<this._padding[0]||t>=this.height-this._padding[2])return this._createBitOffArrayOfLength(this.width);let e=[].concat.apply([],this._characters.map(e=>e.getRow(t-this._padding[0]).concat(this._createBitOffArrayOfLength(this._letterSpacing))));return e=e.slice(0,e.length-this._letterSpacing),this._createBitOffArrayOfLength(this._padding[3]).concat(e).concat(this._createBitOffArrayOfLength(this._padding[1]))}load(t,e,r=1){const i="(",h=")";this._characters=[],this._size=r;for(let r=0;r<t.length;r++){let c=t[r];if("\\"===c){if(r==t.length-1)throw"No character escaped at the end of the string input";c=t[++r]}else if(c===i&&(0===r||"\\"!==t[r-1])){do{if(c+=t[++r],r==t.length)throw`Could not find the ending delimiter "${h}" for pattern ${c}`}while(t[r]!=h);c=c.slice(1,-1)}const o=e.find(c);this._characters.push(new n(o.pattern,new a(s.scale(o.output.atIndexRange(0,o.output.size),o.width,this._size)),o.width*this._size))}this._input=t,this.onPropertyChange.trigger()}_horizontalPaddingWidth(){return this._padding[1]+this._padding[3]}_totalSpacingWidth(){return(this._characters.length-1)*this._letterSpacing}_verticalPaddingWidth(){return this._padding[0]+this._padding[2]}_createBitOffArrayOfLength(t){return Array.apply(null,Array(t)).map(()=>0)}_emitPropertyChangeEvent(t,e){t!=e&&this.onPropertyChange.trigger()}}class o{constructor(t){this.CLASS_NAME=o.name,this._initiated=!1,this._latestCurrentSequenceUuid=0,this.onNewSequence=new h,this._params=t,this._initiated=!0,this.updateCurrentSequence(),this._params.board.PropertyChange.on(()=>{this.updateCurrentSequence()})}get NewSequence(){return this.onNewSequence.expose()}get width(){return this._params.width}get board(){return this._params.board}get increment(){return this._params.increment}get reverse(){return this._params.reverse}get scroller(){return this._params.scroller}set width(t){const e=i.getDescriptionForProperty(this.CLASS_NAME,"width");i.throwIfNull(t,e),i.throwIfNegative(t,e),this._params.width!=t&&(this._params.width=t,this.updateCurrentSequence())}set board(t){i.throwIfNull(t,i.getDescriptionForProperty(this.CLASS_NAME,"board")),this._params.board!=t&&(this._params.board=t,this.updateCurrentSequence())}set increment(t){const e=i.getDescriptionForProperty(this.CLASS_NAME,"fps");i.throwIfNull(t,e),i.throwIfNegative(t,e),this._params.increment!=t&&(this._params.increment=t,this.updateCurrentSequence())}set reverse(t){const e=i.getDescriptionForProperty(this.CLASS_NAME,"reverse");i.throwIfNull(t,e),t!=this._params.reverse&&(this._params.reverse=t,this.updateCurrentSequence())}set scroller(t){const e=i.getDescriptionForProperty(this.CLASS_NAME,"reverse");i.throwIfNull(t,e),t!=this._params.scroller&&(this._params.scroller=t,this.updateCurrentSequence())}GetCurrentSequence(){return new Promise(t=>{let e=[],r=0;for(let t=0;t<=(0==this.increment?0:this._params.scroller.loopEndIndex(this)/this.increment);t++)e.push(this._params.scroller.generatePanelFrameAtIndex(r,this)),r=this._tickPanelIndex(r);t(e)})}updateCurrentSequence(){if(this._initiated){this._latestCurrentSequenceUuid+=1;const t=this._latestCurrentSequenceUuid;this.GetCurrentSequence().then(e=>{t==this._latestCurrentSequenceUuid&&e[0].length>0&&this.onNewSequence.trigger(e)})}}_tickPanelIndex(t){return this._params.reverse?this._decrementIndex(t):this._incrementIndex(t)}_incrementIndex(t){return t>=this._params.scroller.loopEndIndex(this)?0:t+this._params.increment}_decrementIndex(t){return 0===t?this._params.scroller.loopEndIndex(this):t-this._params.increment}}class d{constructor(){this._characters=[]}get characters(){return this._characters}get height(){return Math.max.apply(Math,this._characters.map(t=>t.height))}get length(){return this._characters.length}find(t){const e=this._characters.filter(e=>e.hasPattern(t));if(e&&e.length>0)return e[0];throw`Could not find character ${t} in the alphabet`}add(t){const e=t.map(t=>t.pattern);if(e.filter((t,e,r)=>r.indexOf(t)!=e).length>0)throw"Pattern already used by another pending character";if(this._characters.length>0){if(this._characters.map(t=>t.pattern).filter(t=>-1!=e.indexOf(t)).length>0)throw"Pattern already used by another character"}this._characters.push(...t)}edit(t){let e=!1;if(this._characters.forEach((r,i,n)=>{r.pattern!=t.pattern||e||(n[i]=t,e=!0)}),!e)throw`Could not find character ${t.pattern} in the alphabet. Aborted edit operation`}delete(t){let e=!1;if(this._characters.forEach((r,i,n)=>{r.pattern!=t.pattern||e||(n.splice(i,1),e=!0)}),!e)throw`Could not find character ${t.pattern} in the alphabet. Aborted delete operation`}}class l{loopEndIndex(t){return t.board.width-1}generatePanelFrameAtIndex(t,e){let r=[];for(let i=0;i<e.width;i++)r.push(e.board.getColumnAtIndex(t+i));let i=[];for(let t=0;t<r[0].length;t++)i.push(r.map(e=>e[t]));return i}}class u{constructor(t){this.onReady=new h,this._params=this._validateParameters(t),this._panel=new o({board:new c({letterSpacing:this._params.letterSpacing,padding:this._params.padding,size:this._params.size}),increment:this._params.increment,reverse:this._params.reverse,width:this._params.panelWidth,scroller:this._params.scroller}),this.event={newSequence:this._panel.NewSequence},this._dictionary=new d}get Ready(){return this.onReady.expose()}get size(){return this._size}set size(t){this._size=t,this._panel.board.load(this.input,this._dictionary,this.size),this._panel.GetCurrentSequence()}get loopEndIndex(){return this._panel.scroller.loopEndIndex(this._panel)}addCharacters(t){this._dictionary.add(t)}addCharacter(t){this._dictionary.add([t])}editCharacter(t){this._dictionary.edit(t)}deleteCharacter(t){this._dictionary.delete(t)}get loadedCharacters(){return this._dictionary.characters}get usedCharacters(){return this._panel.board.characters}set letterSpacing(t){this._panel.board.letterSpacing=t}get letterSpacing(){return this._panel.board.letterSpacing}set padding(t){this._panel.board.padding=t}get padding(){return this._panel.board.padding}get width(){return this._panel.board.width}get height(){return this._panel.board.height}set input(t){this._panel.board.load(t,this._dictionary)}get input(){return this._panel.board.input}get sequence(){return this._panel.GetCurrentSequence()}set scroller(t){this._panel.scroller=t}get scroller(){return this._panel.scroller}get reverse(){return this._panel.reverse}set increment(t){this._panel.increment=t}get increment(){return this._panel.increment}set reverse(t){this._panel.reverse=t}set viewportWidth(t){this._panel.width=t}get viewportWidth(){return this._panel.width}_validateParameters(t){let e={increment:1,scroller:new l,reverse:!1,panelWidth:78,letterSpacing:2,padding:[0,20,0,0],size:1};return t?(t.letterSpacing=this._valueOrDefaultIfNull(t.letterSpacing,e.letterSpacing),t.padding=this._valueOrDefaultIfNull(t.padding,e.padding),t.size=this._valueOrDefaultIfNull(t.size,e.size),t.increment=this._valueOrDefaultIfNull(t.increment,e.increment),t.scroller=this._valueOrDefaultIfNull(t.scroller,e.scroller),t.reverse=this._valueOrDefaultIfNull(t.reverse,e.reverse),t.panelWidth=this._valueOrDefaultIfNull(t.panelWidth,e.panelWidth),t):e}_valueOrDefaultIfNull(t,e){return null==t?e:t}}class p{loopEndIndex(t){return t.board.height-1}generatePanelFrameAtIndex(t,e){let r=[];for(let i=0;i<e.board.height;i++){let n;n=e.board.getRowAtIndex(t+i),r.push(n.slice(0,e.width))}return r}}var _;!function(t){t[t.Side=0]="Side",t[t.Vertical=1]="Vertical"}(_||(_={}));class g{static build(t){switch(t){case _.Side:return new l;case _.Vertical:return new p}}}class f{static import(t,e){fetch(t).then(t=>t.text()).then(t=>{e(f.parse(t))}).catch(e=>{throw`Couldn't fetch file: ${t}`})}static export(){}static parse(t){const e=JSON.parse(t);if(null==e)throw"Invalid character json file";if(null==e.characters)throw"Invalid character json file: Can't find property characters";return e.characters.map(t=>{if(null==t.pattern)throw"Invalid character json file: Can't find property patterns for a character";if(null==t.output)throw"Invalid character json file: Can't find property output for a character";if(null==t.width)throw"Invalid character json file: Can't find property width for a character";return new n(t.pattern,new a(t.output.map(t=>t)),t.width)})}static stringify(t){return null==t||0==t.length?JSON.stringify(""):JSON.stringify({characters:t.map(t=>({patterns:t.pattern,output:t.output.atIndexRange(0,t.output.size),width:t.width}))})}}r.d(e,"LedMatrix",function(){return u}),r.d(e,"ScrollerTypes",function(){return _}),r.d(e,"ScrollerBuilder",function(){return g}),r.d(e,"SideScroller",function(){return l}),r.d(e,"VerticalScroller",function(){return p}),r.d(e,"Board",function(){return c}),r.d(e,"CharacterDictionary",function(){return d}),r.d(e,"CharactersJSON",function(){return f}),r.d(e,"NearestNeighbor",function(){return s}),r.d(e,"Character",function(){return n}),r.d(e,"Panel",function(){return o}),r.d(e,"BitArray",function(){return a}),r.d(e,"Event",function(){return h}),r.d(e,"Exception",function(){return i})}])});
//# sourceMappingURL=led-matrix.min.js.map